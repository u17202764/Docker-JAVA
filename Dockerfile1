# Etapa 1: Construcción con Maven usando Amazon Corretto
FROM maven:3.9.9-amazoncorretto-17 AS builder

# Establece el directorio de trabajo en el contenedor
WORKDIR /app

# Copia solo el archivo pom.xml primero para que Maven resuelva dependencias antes de copiar el código
COPY pom.xml /app/

# Descargar las dependencias (esto se puede aprovechar si no cambian frecuentemente)
RUN mvn dependency:go-offline

# Copia el código fuente solo después de resolver dependencias
COPY src /app/src/

# Ejecuta Maven para compilar el proyecto y generar el archivo JAR
RUN mvn clean install -DskipTests

# Etapa 2: Imagen final para ejecutar la aplicación
FROM amazoncorretto:17-alpine

# Establece el directorio de trabajo en el contenedor
WORKDIR /app

# Copia el archivo JAR desde la etapa de construcción
COPY --from=builder /app/target/mi-aplicacion-*.jar /app/app.jar

# Exponer el puerto donde tu aplicación se ejecuta
EXPOSE 8082

# Define el comando de inicio
ENTRYPOINT ["java", "-jar", "/app/app.jar"]

